# 创建密钥对<a name="ZH-CN_TOPIC_0014250631"></a>

## 操作场景<a name="section4859995204421"></a>

为安全起见，弹性云服务器登录时建议使用密钥方式进行身份验证。因此，您需要使用已有密钥对或新建一个密钥对，用于远程登录身份验证。

-   新建密钥对

    如果没有可用的密钥对，需新建一个密钥对，生成公钥和私钥，并在登录弹性云服务器时提供私钥进行鉴权。创建密钥对的方法如下：

    -   （推荐）通过管理控制台创建密钥对，公钥自动保存在系统中，私钥由用户保存在本地，具体操作请参见[通过管理控制台创建密钥对](#section35336147204538)。
    -   通过puttygen.exe工具创建密钥对，公钥和私钥均保存在用户本地，具体操作请参见[通过puttygen.exe工具创建密钥对](#section38463609165715)。创建成功的密钥对，还需要执行[导入密钥对](#section62005706143441)，导入系统才能正常使用密钥对。

-   使用已有密钥对

    如果本地已有密钥对（例如，使用PuTTYgen工具生成的密钥对），可以在管理控制台导入密钥对公钥，由系统维护您的公钥文件。具体操作请参见[导入密钥对](#section62005706143441)。

    >![](public_sys-resources/icon-note.gif) **说明：** 
    >如果已有密钥对的公钥文件是通过puttygen.exe工具的“Save public key”按钮保存的，该公钥文件不能直接导入管理控制台。
    >如需继续使用该密钥对作远程身份验证，请参见[通过puttygen.exe工具创建的密钥对，导入管理控制台失败怎么办？](https://support.huaweicloud.com/ecs_faq/ecs_faq_1220.html)


## 约束与限制<a name="section57670118165256"></a>

-   当前支持的加解密算法为：
    -   SSH-2 \(RSA，1024\)
    -   SSH-2 \(RSA，2048\)
    -   SSH-2 \(RSA，4096\)

-   私钥是保证您的弹性云服务器安全的重要手段之一，用于远程登录身份认证，为保证弹性云服务器安全，只能下载一次，请妥善保管。

## 通过管理控制台创建密钥对<a name="section35336147204538"></a>

1.  登录管理控制台。
2.  单击管理控制台左上角的![](figures/icon-region.png)，选择区域和项目。
3.  选择“计算 \> 弹性云服务器”。
4.  在左侧导航树中，选择“密钥对”。
5.  在“密钥对”页面，单击“创建密钥对”。
6.  输入密钥名称，单击“确定”。

    密钥名称由两部分组成：KeyPair-4位随机数字，使用一个容易记住的名称，如KeyPair-xxxx\_ecs。

7.  您的浏览器会提示您下载或自动下载私钥文件。文件名是您为密钥对指定的名称，文件扩展名为“.pem”。请将私钥文件保存在安全位置。然后在系统弹出的提示框中单击“确定”。

    >![](public_sys-resources/icon-note.gif) **说明：** 
    >这是您保存私钥文件的唯一机会，请妥善保管。当您创建弹性云服务器时，您将需要提供密钥对的名称；每次SSH登录到弹性云服务器时，您将需要提供相应的私钥。


## 通过puttygen.exe工具创建密钥对<a name="section38463609165715"></a>

1.  在以下路径中下载并安装PuTTY和PuTTYgen。

    [https://www.chiark.greenend.org.uk/\~sgtatham/putty/latest.html](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html)

    >![](public_sys-resources/icon-note.gif) **说明：** 
    >PuTTYgen是密钥生成器，用于创建密钥对，生成一对公钥和私钥供PuTTY使用。

2.  生成公钥和私钥文件。
    1.  双击“PUTTYGEN.EXE”，打开“PuTTY Key Generator”。

        **图 1**  PuTTY Key Generator<a name="zh-cn_topic_0037960038_fig4490538015580"></a>  
        ![](figures/PuTTY-Key-Generator.png "PuTTY-Key-Generator")

    2.  单击“Generate”。

        密钥生成器将自动生成一对公钥和私钥，其中，[图2](#zh-cn_topic_0037960038_fig4678746517750)的红框内容为生成的公钥文件。

        **图 2**  生成公钥和私钥文件<a name="zh-cn_topic_0037960038_fig4678746517750"></a>  
        ![](figures/生成公钥和私钥文件.png "生成公钥和私钥文件")

3.  <a name="li24584709151818"></a>复制红框中的公钥内容，并将其粘贴在文本文档中，以.txt格式保存在本地，保存公钥文件。

    >![](public_sys-resources/icon-note.gif) **说明：** 
    >请勿直接单击“Save public key”保存公钥文件。因为通过puttygen.exe工具的“Save public key”按钮保存在本地的公钥文件，公钥内容的格式会发生变化，不能直接导入管理控制台使用。

4.  保存私钥文件。

    根据不同用途，需将私钥文件保存为不同格式。为保证安全，私钥只能下载一次，请妥善保管。

    -   保存私钥文件为“.ppk“格式。

        当用户使用PuTTY工具登录Linux弹性云服务器时，需使用“.ppk“格式的私钥文件。保存方法如下：

        1.  在“PuTTY Key Generator”界面，选择“File \> Save private key”。

            **图 3**  保存私钥文件<a name="fig1031955919299"></a>  
            ![](figures/保存私钥文件.png "保存私钥文件")

        2.  保存转化后的私钥到本地。例如：kp-123.ppk

    -   保存私钥文件为“.pem“格式。

        当用户使用Xshell工具登录Linux弹性云服务器，或者获取Windows弹性云服务器的密码时，需使用“.pem“格式的私钥文件。保存方法如下：

        1.  选择“Conversions \> Export OpenSSH key”。

            >![](public_sys-resources/icon-note.gif) **说明：** 
            >如果该私钥文件用于Windows弹性云服务器的获取密码操作，在选择“Export OpenSSH key”时，请勿填写“Key passphrase”信息，否则会导致获取密码失败。

            **图 4**  保存私钥文件<a name="fig15752222153016"></a>  
            ![](figures/保存私钥文件-9.png "保存私钥文件-9")

        2.  保存私钥到本地。例如：kp-123.pem

5.  公钥和私钥文件按照需要正确保存后，请参见[导入密钥对](#section62005706143441)的“复制公钥文件内容方式”，将公钥导入系统中。

## 导入密钥对<a name="section62005706143441"></a>

通过puttygen.exe工具的“Save public key”按钮保存在本地的公钥文件，公钥内容的格式会发生变化，不能直接导入管理控制台。

1.  登录管理控制台。
2.  单击管理控制台左上角的![](figures/icon-region.png)，选择区域和项目。
3.  选择“计算 \> 弹性云服务器”。
4.  在左侧导航树中，选择“密钥对”。
5.  在“密钥对”页面，单击“导入密钥对”。
6.  导入密钥对的方式有如下两种：
    -   选择文件方式：将本地已有的可用密钥，导入到系统中。
        1.  在管理控制台“导入密钥对”页面，单击“选择文件”，选择本地保存的公钥文件（例如，[3](#li24584709151818)中保存的“.txt”格式文件）。

            >![](public_sys-resources/icon-note.gif) **说明：** 
            >执行“导入密钥对”操作时，请确认导入的是公钥文件，否则会导入失败。

        2.  单击“确定”，导入公钥。

            公钥导入成功后，您可以修改公钥名称。

    -   复制公钥文件内容方式：将“.txt”格式文本文档中的公钥内容粘贴至对话框，导入到系统中。
        1.  复制文本文档中保存的公钥文件内容，并将其粘贴在“公钥内容”的空白区域。
        2.  单击“确定”，导入公钥。



## 私钥文件丢失或泄露怎么办？<a name="section11905173235417"></a>

建议您开启[数据加密服务](https://www.huaweicloud.com/product/dew.html)（Data Encryption Workshop）。开启后，您可以管理密钥对，包括绑定、查看、重置、替换、解绑、删除密钥对等。具体操作，请参见“[管理密钥对](https://support.huaweicloud.com/usermanual-dew/dew_01_0071.html)”。

示例：

-   如果私钥文件丢失，您可以通过“重置密钥对”功能重新配置弹性云服务器的密钥对。
-   如果私钥文件泄露，您可以通过“替换密钥对”功能使用新的密钥对替换弹性云服务器内的公钥。

