# 变更规格（批量操作）<a name="ecs_03_3101"></a>

## 操作场景<a name="zh-cn_topic_0013859511_section14602858172718"></a>

当您购买的多台弹性云服务器的规格无法满足业务需要时，可以参考本章节批量变更规格，升级vCPU、内存。

不同计费模式弹性云服务器的批量变更规格操作不同，本文将分别进行介绍：

-   [操作步骤（按需计费）](#section997143905215)
-   [操作步骤（包年/包月）](#section9782153014187)

## 约束与限制<a name="zh-cn_topic_0013859511_section57753505172833"></a>

-   批量变更规格操作仅支持对相同可用区、相同计费模式以及相同规格的弹性云服务器实例进行变更。
-   变更规格时，不能选择已售罄的CPU和内存资源。
-   弹性云服务器规格（CPU或内存）变小，会影响弹性云服务器的性能。
-   对于部分类型的弹性云服务器，暂不支持规格变更操作。[实例类型](https://support.huaweicloud.com/productdesc-ecs/zh-cn_topic_0035470096.html)章节列举了提供的云服务器类型，并对每种云服务器类型的功能、使用进行介绍，具体请以各类型云服务器的“使用须知”为准。
-   当云硬盘状态为“正在扩容”时，不支持变更所挂载的弹性云服务器规格。
-   Windows操作系统的弹性云服务器，执行变更规格操作前建议您参考[磁盘脱机怎么办？](https://support.huaweicloud.com/ecs_faq/zh-cn_topic_0114225937.html)修改Windows操作系统SAN策略，避免变更规格后磁盘处于脱机状态。
-   Windows 2016操作系统的弹性云服务器，执行变更操作前建议您参考[为什么Windows 2016操作系统的云服务器实例变更到C7规格后蓝屏？](https://support.huaweicloud.com/ecs_faq/ecs_faq_0621.html)修改注册表信息，避免变更规格后出现蓝屏。

## 费用说明<a name="section33114418403"></a>

变更规格会引起费用的变化，具体费用说明请参见[变更资源费用说明](https://support.huaweicloud.com/usermanual-billing/renewals_topic_60000001.html)。

## 变更前准备<a name="section201182131618"></a>

变更规格后，可能会出现网卡漂移现象，请在变更规格前做如下操作：

>![](public_sys-resources/icon-note.gif) **说明：** 
>出现网卡漂移的现象，是由于创建云服务器使用的镜像的操作系统中打开了网卡保留规则，才导致该云服务器变更规格后出现网卡漂移。
>关于网卡漂移的更多信息，请参见[弹性云服务器变更规格后网卡漂移怎么办？](https://support.huaweicloud.com/ecs_faq/ecs_faq_1311.html)。

-   Linux系统：

    在云服务器中执行以下命令，删除网络规则目录下，文件名同时包含**persistent**和**net**的规则文件

    **rm -fr /etc/udev/rules.d/\*net\*persistent\*.rules**

    **rm -fr /etc/udev/rules.d/\*persistent\*net\*.rules**

-   Windows系统：

    在云服务器中删除如下注册表下的目录。

    HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Profiles

    HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\NetworkList\\Signatures\\Unmanaged

    **图 1**  注册表<a name="fig18511613141912"></a>  
    ![](figures/注册表-7.png "注册表-7")

## 操作步骤（按需计费）<a name="section997143905215"></a>

**批量变更规格**

1.  登录管理控制台。
2.  单击管理控制台左上角的![](figures/icon-region.png)，选择区域和项目。
3.  单击“![](figures/service-list-8.jpg)”，选择“计算 \> 弹性云服务器”。
4.  勾选待变更的弹性云服务器实例，单击列表上方的“更多 \> 变更规格 \> 按需云服务器规格变更”。

    系统进入“云服务器变更规格”页面。

5.  根据界面提示，选择变更后的弹性云服务器类型、vCPU和内存。

    变更规格前请先将云服务器关机，或根据页面提示勾选“立即关机”。

    **图 2**  批量变更规格（按需计费）<a name="fig1167134453919"></a>  
    ![](figures/批量变更规格（按需计费）.png "批量变更规格（按需计费）")

6.  （可选）根据界面提示，检查并修改云服务器系统的fstab、grub，修改完成后勾选“我确认已完成对弹性云服务器的配置”。
7.  确认变更后的配置无误后，阅读并勾选同意服务协议，单击“提交”。
8.  查询规格是否变更成功。

    申请变更规格后，可以通过“异常任务”栏查看规格是否变更成功。

    1.  查看控制台是否显示“异常任务”栏，查看操作请参见[查看失败任务](查看失败任务.md)。
        -   是，执行[8.b](#li6253192246)。
        -   否，变更规格成功。

    2.  <a name="li6253192246"></a>打开“异常任务”，根据弹性云服务器的“名称/ID”、“操作时间”和“任务”，确认列表中是否有刚刚执行的变更规格任务。
        -   是，变更规格失败，失败原因请参见[后续处理](#section9461027528)。
        -   否，变更规格成功。

**检查磁盘挂载状态**

变更规格时，可能会发生磁盘挂载失败的情况，因此，变更规格后，需检查磁盘挂载状态是否正常。如果正常，则变更成功。

-   Windows弹性云服务器

    详细操作请参考[Windows云服务器变更规格后数据盘脱机怎么办？](https://support.huaweicloud.com/ecs_faq/ecs_faq_0618.html)

-   Linux弹性云服务器

    详细操作请参考[Linux云服务器变更规格后数据盘脱机怎么办？](https://support.huaweicloud.com/ecs_faq/ecs_faq_0619.html)

## 操作步骤（包年/包月）<a name="section9782153014187"></a>

**批量变更规格**

1.  登录管理控制台。
2.  单击管理控制台左上角的![](figures/icon-region.png)，选择区域和项目。
3.  单击“![](figures/service-list-9.jpg)”，选择“计算 \> 弹性云服务器”。
4.  勾选待变更的弹性云服务器实例，单击列表上方的“更多 \> 变更规格 \> 包年/包月云服务器规格变更”。

    系统进入“云服务器变更规格”页面。

5.  根据界面提示，选择变更后的弹性云服务器类型、vCPU和内存。

    变更规格前请先将云服务器关机，或根据页面提示勾选“立即关机”。

    **图 3**  批量变更规格（包年/包月）<a name="fig8967191111914"></a>  
    ![](figures/批量变更规格（包年-包月）.png "批量变更规格（包年-包月）")

6.  （可选）根据界面提示，检查并修改云服务器系统的fstab、grub，修改完成后勾选“我确认已完成对弹性云服务器的配置”。
7.  确认变更后的配置无误后，阅读并勾选同意服务协议，单击“提交申请”。
8.  查询规格是否变更成功。

    申请变更规格后，可以通过“异常任务”栏查看规格是否变更成功。

    1.  查看控制台是否显示“异常任务”栏，查看操作请参见[查看失败任务](查看失败任务.md)。
        -   是，执行[8.b](#li9968311111913)。
        -   否，变更规格成功。

    2.  <a name="li9968311111913"></a>打开“异常任务”，根据弹性云服务器的“名称/ID”、“操作时间”和“任务”，确认列表中是否有刚刚执行的变更规格任务。
        -   是，变更规格失败，失败原因请参见[后续处理](#section9461027528)。
        -   否，变更规格成功。

**检查磁盘挂载状态**

变更规格时，可能会发生磁盘挂载失败的情况，因此，变更规格后，需检查磁盘挂载状态是否正常。如果正常，则变更成功。

-   Windows弹性云服务器

    详细操作请参考[Windows云服务器变更规格后数据盘脱机怎么办？](https://support.huaweicloud.com/ecs_faq/ecs_faq_0618.html)

-   Linux弹性云服务器

    详细操作请参考[Linux云服务器变更规格后数据盘脱机怎么办？](https://support.huaweicloud.com/ecs_faq/ecs_faq_0619.html)

## 后续处理<a name="section9461027528"></a>

如果变更规格失败，请到云审计页面查看失败原因。具体操作如下：

1.  登录管理控制台。
2.  选择“ \> 云审计服务”。
3.  在左侧导航栏，选择“云审计 \> 事件列表”。
4.  在“事件名称”栏，根据“资源ID”查找到名称为“resizeServer”的规格变更失败事件。

    其中，“资源ID”为规格变更失败的弹性云服务器ID。

5.  单击“操作”列下的“查看事件”，查看失败原因。

    如果无法根据日志解决问题，可联系客服。

