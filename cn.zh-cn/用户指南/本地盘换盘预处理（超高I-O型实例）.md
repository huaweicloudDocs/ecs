# 本地盘换盘预处理（超高I/O型实例）<a name="ecs_03_2307"></a>

## 操作场景<a name="section117378514391"></a>

当进行“本地盘换盘”事件的“授权换盘”操作时，需要先对本地盘进行换盘预处理。

本文介绍如何对超高I/O型（I系列）的ECS实例进行本地盘的换盘预处理操作。

>![](public_sys-resources/icon-notice.gif) **须知：** 
>本地盘换盘操作需要在预约时间后的6个工作日内完成，在此期间业务不可用，请谨慎操作。
>超高I/O型实例的本地盘换盘操作需要在“关机”状态下进行。
>本地盘换盘操作会丢失故障本地盘上的数据，如果无需保留本地盘上的数据，可通过本操作授权换盘。
>如果需要保留本地盘上的数据，请勿授权，结束操作并联系技术支持进行处理。

## 操作步骤（Linux实例）<a name="section15293423191212"></a>

**获取故障本地盘标识符**

1.  登录管理控制台。
2.  单击管理控制台左上角的![](figures/icon-region.png)，选择区域和项目。
3.  单击“![](figures/service-list-66.jpg)”，选择“计算 \> 弹性云服务器”。
4.  在左侧导航树中，选择“事件”。
5.  在事件列表中，查看“本地盘换盘”事件的“事件描述”列。

    通过“事件描述”信息获取故障本地盘的SN号，本文以“1003004212241800EY”为例进行介绍。

**获取故障本地盘挂载点**

1.  [远程登录](远程登录Linux弹性云服务器（VNC方式）.md)待换盘预处理的弹性云服务器。
2.  执行以下命令，查看故障盘的SN号对应的盘符信息。

    **ll /dev/disk/by-id/ | grep  _SN号_**

    以SN号“1003004212241800EY”为例，命令如下：

    **ll /dev/disk/by-id/ | grep 1003004212241800EY**

    回显信息如下：

    ```
    lrwxrwxrwx 1 root root 13 Dec 14 18:55 nvme-RP2001T6RK004VX_1003004212241800EY -> ../../nvme0n1
    ```

3.  执行以下命令，查询故障盘的挂载点。

    **df -Th | grep **_**盘符信息**_

    以盘符信息“/dev/nvme0n1”为例，命令如下：

    **df -Th| grep /dev/nvme0n1**

    回显信息如下：

    ```
    /dev/nvme0n1   ext4   1.5T 77M 1.4T 1%  /data
    ```

    >![](public_sys-resources/icon-notice.gif) **须知：** 
    >本地盘换盘操作会导致本地盘数据丢失。如需保留本地盘数据，请勿授权，结束操作并联系技术支持进行处理。

**卸载故障的本地磁盘**

1.  执行以下命令，卸载故障的本地磁盘。

    **umount   _挂载点_**

    以挂载点“/data”为例，命令如下：

    **umount  /data**

**检查报障云服务器的/etc/fstab中是否配置了故障盘对应的自动挂载信息**

>![](public_sys-resources/icon-note.gif) **说明：** 
>如果报障云服务器的/etc/fstab中配置了故障盘对应的自动挂载信息，则需要注释掉，防止本地盘换盘后启动云服务器进入维护模式。

1.  <a name="li42132496545"></a>执行以下命令，查询磁盘分区的UUID。

    **blkid **_**磁盘分区**_

    以查询磁盘分区“/dev/nvme0n1”的UUID为例：

    **blkid /dev/nvme0n1**

    回显信息如下：

    ```
    /dev/nvme0n1: UUID="11e39b6b-07fc-4675-8302-04c7ce7e30bd" TYPE="ext4"
    ```

1.  <a name="li19468752185416"></a>执行以下命令，查询/etc/fstab中是否存在磁盘分区的自动挂载信息。

    **cat /etc/fstab | grep  _磁盘分区的UUID_**

    以查询磁盘分区的UUID“11e39b6b-07fc-4675-8302-04c7ce7e30bd”为例，命令如下：

    **cat /etc/fstab | grep 11e39b6b-07fc-4675-8302-04c7ce7e30bd**

    回显信息如下，表示/etc/fstab中存在磁盘分区的自动挂载信息：

    ```
    UUID=11e39b6b-07fc-4675-8302-04c7ce7e30bd    /mnt   ext4    defaults        0 0
    ```

2.  如果存在挂载信息，执行以下命令，删除磁盘分区的自动挂载信息，避免在更换本地盘后，云服务器开机时进入维护模式。
    1.  执行以下命令，编辑/etc/fstab文件。

        **vi /etc/fstab**

    2.  单击“i”进入编辑模式。
    3.  删除或注释掉步骤[2](#li19468752185416)中查询的磁盘分区的自动挂载信息。

        根据步骤[1](#li42132496545)中查询的UUID，注释该条信息。

        在自动挂载信息前面添加\#，表示注释掉自动挂载信息，示例如下：

        ```
        # UUID=11e39b6b-07fc-4675-8302-04c7ce7e30bd    /mnt   ext4    defaults        0 0
        ```

    4.  单击Esc键并输入**:wq**后回车，保存并退出编辑模式。

**云服务器关机**

1.  在事件列表中，查看“本地盘换盘”事件对应的实例ID。

1.  在左侧导航选择“弹性云服务器”，在报障的云服务器“操作”列，单击“更多 \> 关机”。

    >![](public_sys-resources/icon-note.gif) **说明：** 
    >本地盘换盘需要通过将云服务器关机再开机的过程，将新的本地盘信息同步至虚拟化层。

## 操作步骤（Windows实例）<a name="section1867718221417"></a>

**获取故障本地盘标识符**

1.  登录管理控制台。
2.  单击管理控制台左上角的![](figures/icon-region.png)，选择区域和项目。
3.  单击“![](figures/service-list-67.jpg)”，选择“计算 \> 弹性云服务器”。
4.  在左侧导航树中，选择“事件”。
5.  在事件列表中，查看“本地盘换盘”事件的“事件描述”列。

    通过“事件描述”信息获取故障本地盘的SN号，本文以“WS22LX16”为例进行介绍。

**获取磁盘编号，确认影响范围**

1.  [远程登录](远程登录Windows弹性云服务器（VNC方式）.md)待换盘预处理的弹性云服务器。
2.  以管理员身份打开“Windows PowerShell”，查询磁盘编号和SN号的对应关系，获取磁盘编号。

    Get-Disk | select Number, SerialNumber

    **图 1**  查询磁盘编号和SN号的对应关系<a name="fig443115493412"></a>  
    ![](figures/查询磁盘编号和SN号的对应关系-68.png "查询磁盘编号和SN号的对应关系-68")

    >![](public_sys-resources/icon-notice.gif) **须知：** 
    >本地盘换盘操作会导致本地盘数据丢失。如需保留本地盘数据，请勿授权，结束操作并联系技术支持进行处理。

**云服务器关机**

1.  在事件列表中，查看“本地盘换盘”事件对应的实例ID。

1.  在左侧导航选择“弹性云服务器”，在报障的云服务器“操作”列，单击“更多 \> 关机”。

    >![](public_sys-resources/icon-note.gif) **说明：** 
    >本地盘换盘需要通过将云服务器关机再开机的过程，将新的本地盘信息同步至虚拟化层。

